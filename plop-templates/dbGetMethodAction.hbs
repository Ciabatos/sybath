// GENERATED CODE - DO NOT EDIT MANUALLY - dbGetMethodAction.hbs

"use server"
import { query } from "@/db/postgresMainDatabase/postgresMainDatabase"
import { snakeToCamelRows } from "@/methods/functions/util/snakeToCamel"

{{#if methodParamsColumns}}
export type {{methodParamsTypeName}} = {
{{#each methodParamsColumns}}
  {{camelName}}: {{tsType}}
{{/each}}
}
{{/if}}

export type {{methodTypeName}} = {
{{#each methodColumns}}
  {{camelName}}{{optional}}: {{tsType}}
{{/each}}
}

export async function {{methodCamelName}}({{#if methodParamsColumns}}params: {{methodParamsTypeName}}{{/if}}) {
  try {
    {{#if methodParamsColumns}}
    const sqlParams = Object.values(params)
    const sql = `SELECT {{schema}}.{{method}}({{sqlParamsPlaceholders}});`
    const result = await query(sql, sqlParams)
    {{else}}
    const sql = `SELECT {{schema}}.{{method}}();`
    const result = await query(sql)
    {{/if}}

    return snakeToCamelRows(result.rows[0]?.result) as {{methodTypeName}}
  } catch (error) {
    console.error("Error executing {{methodCamelName}}:", error)
    throw new Error("Failed to execute {{methodCamelName}}")
  }
}
